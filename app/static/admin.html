<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1"
    />
    <title>Frais Réels - Administration</title>
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <div class="page admin-page">
      <header class="page-header">
        <div>
          <p class="eyebrow">Frais Réels</p>
          <h1>Administration</h1>
          <p class="subtitle">
            Référentiels et saisie des frais par personne.
          </p>
        </div>
        <div class="controls">
          <a class="ghost link-button" href="/dashboard">
            Retour au tableau de bord
          </a>
          <button id="admin-refresh" type="button">
            Rafraîchir
          </button>
        </div>
      </header>

      <section class="admin" aria-label="Référentiels">
        <div class="forms-header">
          <div>
            <h2>Référentiels stables</h2>
            <p class="subtitle">
              Foyers, personnes, véhicules et barème kilométrique.
            </p>
          </div>
          <p class="hint" id="admin-status">
            Chargement des référentiels...
          </p>
        </div>
        <div class="admin-grid">
          <div class="table-card">
            <div class="table-header">
              <h3>Foyers</h3>
              <p class="hint">Identifiants utilisés pour les personnes.</p>
            </div>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Nom</th>
                  </tr>
                </thead>
                <tbody id="households-table"></tbody>
              </table>
            </div>
          </div>
          <div class="table-card">
            <div class="table-header">
              <h3>Personnes</h3>
              <p class="hint">Rattachées à leur foyer.</p>
            </div>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Foyer</th>
                    <th>Nom</th>
                  </tr>
                </thead>
                <tbody id="persons-table"></tbody>
              </table>
            </div>
          </div>
          <div class="table-card">
            <div class="table-header">
              <h3>Véhicules</h3>
              <p class="hint">Rattachés à une personne.</p>
            </div>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Personne</th>
                    <th>Nom</th>
                    <th>CV</th>
                  </tr>
                </thead>
                <tbody id="vehicles-table"></tbody>
              </table>
            </div>
          </div>
          <div class="table-card">
            <div class="table-header">
              <h3>Barème kilométrique</h3>
              <p class="hint">Variables selon la puissance fiscale.</p>
            </div>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>CV</th>
                    <th>Tranche (km)</th>
                    <th>Taux</th>
                    <th>Forfait</th>
                  </tr>
                </thead>
                <tbody id="mileage-scale-table"></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <section class="entry" aria-label="Saisie des frais">
        <div class="forms-header">
          <div>
            <h2>Saisie par personne</h2>
            <p class="subtitle">
              Ajoutez, modifiez ou supprimez les trajets, repas et frais.
            </p>
          </div>
          <div class="controls">
            <label class="field">
              <span>Personne</span>
              <select id="person-select" required></select>
            </label>
            <label class="field">
              <span>Année</span>
              <input
                id="entry-year"
                type="number"
                min="2000"
                max="2100"
                value="2024"
              />
            </label>
            <button id="entry-refresh" type="button">
              Charger les données
            </button>
          </div>
          <p class="hint" id="entry-status">
            Sélectionnez une personne pour charger ses frais.
          </p>
        </div>

        <div class="entry-grid">
          <div class="table-card">
            <div class="table-header">
              <h3>Trajets</h3>
              <p class="hint">
                Ajoutez un trajet et utilisez le menu pour modifier.
              </p>
            </div>
            <form id="mileage-add-form" class="table-form">
              <label class="field">
                <span>Véhicule</span>
                <select id="mileage-vehicle" required></select>
              </label>
              <label class="field">
                <span>Mois</span>
                <input
                  id="mileage-month"
                  type="number"
                  min="1"
                  max="12"
                  required
                />
              </label>
              <label class="field">
                <span>Kilomètres</span>
                <input
                  id="mileage-km"
                  type="number"
                  min="0"
                  step="0.1"
                  required
                />
              </label>
              <button type="submit">Ajouter</button>
            </form>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>Mois</th>
                    <th>Véhicule</th>
                    <th>Kilomètres</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="mileage-table"></tbody>
              </table>
            </div>
          </div>

          <div class="table-card">
            <div class="table-header">
              <h3>Repas</h3>
              <p class="hint">Saisie des repas déductibles.</p>
            </div>
            <form id="meal-add-form" class="table-form">
              <label class="field">
                <span>Mois</span>
                <input
                  id="meal-month"
                  type="number"
                  min="1"
                  max="12"
                  required
                />
              </label>
              <label class="field">
                <span>Coût</span>
                <input
                  id="meal-cost"
                  type="number"
                  min="0"
                  step="0.1"
                  required
                />
              </label>
              <button type="submit">Ajouter</button>
            </form>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>Mois</th>
                    <th>Coût</th>
                    <th>Déductible</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="meal-table"></tbody>
              </table>
            </div>
          </div>

          <div class="table-card">
            <div class="table-header">
              <h3>Frais divers</h3>
              <p class="hint">Saisie des frais hors repas et trajets.</p>
            </div>
            <form id="other-add-form" class="table-form">
              <label class="field">
                <span>Libellé</span>
                <input
                  id="other-description"
                  type="text"
                  maxlength="255"
                  required
                />
              </label>
              <label class="field">
                <span>Montant</span>
                <input
                  id="other-amount"
                  type="number"
                  min="0"
                  step="0.1"
                  required
                />
              </label>
              <label class="field">
                <span>Pièce jointe</span>
                <input
                  id="other-attachment"
                  type="text"
                  maxlength="255"
                  placeholder="facture.pdf"
                />
              </label>
              <button type="submit">Ajouter</button>
            </form>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>Libellé</th>
                    <th>Montant</th>
                    <th>Pièce jointe</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="other-table"></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>
    </div>

    <dialog id="mileage-edit-dialog" class="modal">
      <form id="mileage-edit-form" class="modal-form">
        <div class="modal-header">
          <h3>Modifier un trajet</h3>
          <button type="button" class="icon-button" data-dialog-close>
            ✕
          </button>
        </div>
        <div class="modal-body">
          <input id="mileage-edit-id" type="hidden" />
          <label class="field">
            <span>Véhicule</span>
            <select id="mileage-edit-vehicle" required></select>
          </label>
          <label class="field">
            <span>Mois</span>
            <input
              id="mileage-edit-month"
              type="number"
              min="1"
              max="12"
              required
            />
          </label>
          <label class="field">
            <span>Kilomètres</span>
            <input
              id="mileage-edit-km"
              type="number"
              min="0"
              step="0.1"
              required
            />
          </label>
        </div>
        <div class="modal-actions">
          <button type="submit">Enregistrer</button>
          <button type="button" class="ghost" data-dialog-close>
            Annuler
          </button>
        </div>
      </form>
    </dialog>

    <dialog id="meal-edit-dialog" class="modal">
      <form id="meal-edit-form" class="modal-form">
        <div class="modal-header">
          <h3>Modifier un repas</h3>
          <button type="button" class="icon-button" data-dialog-close>
            ✕
          </button>
        </div>
        <div class="modal-body">
          <input id="meal-edit-id" type="hidden" />
          <label class="field">
            <span>Mois</span>
            <input
              id="meal-edit-month"
              type="number"
              min="1"
              max="12"
              required
            />
          </label>
          <label class="field">
            <span>Coût</span>
            <input
              id="meal-edit-cost"
              type="number"
              min="0"
              step="0.1"
              required
            />
          </label>
        </div>
        <div class="modal-actions">
          <button type="submit">Enregistrer</button>
          <button type="button" class="ghost" data-dialog-close>
            Annuler
          </button>
        </div>
      </form>
    </dialog>

    <dialog id="other-edit-dialog" class="modal">
      <form id="other-edit-form" class="modal-form">
        <div class="modal-header">
          <h3>Modifier un frais divers</h3>
          <button type="button" class="icon-button" data-dialog-close>
            ✕
          </button>
        </div>
        <div class="modal-body">
          <input id="other-edit-id" type="hidden" />
          <label class="field">
            <span>Libellé</span>
            <input
              id="other-edit-description"
              type="text"
              maxlength="255"
              required
            />
          </label>
          <label class="field">
            <span>Montant</span>
            <input
              id="other-edit-amount"
              type="number"
              min="0"
              step="0.1"
              required
            />
          </label>
          <label class="field">
            <span>Pièce jointe</span>
            <input
              id="other-edit-attachment"
              type="text"
              maxlength="255"
            />
          </label>
        </div>
        <div class="modal-actions">
          <button type="submit">Enregistrer</button>
          <button type="button" class="ghost" data-dialog-close>
            Annuler
          </button>
        </div>
      </form>
    </dialog>

    <script src="/static/admin.js"></script>
  </body>
</html>
