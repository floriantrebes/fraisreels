<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1"
    />
    <title>Frais Réels - Administration</title>
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <div class="page">
      <header class="page-header">
        <div>
          <p class="eyebrow">Frais Réels</p>
          <h1>Administration</h1>
          <p class="subtitle">
            Gérez les référentiels et saisissez les opérations.
          </p>
        </div>
        <div class="controls">
          <a class="ghost-button" href="/dashboard">
            Retour au tableau de bord
          </a>
        </div>
      </header>

      <section class="admin" aria-label="Référentiels">
        <div class="forms-header">
          <div>
            <h2>Référentiels</h2>
            <p class="subtitle">
              Foyers, personnes, véhicules et barème kilométrique.
            </p>
          </div>
          <div class="controls">
            <button id="admin-refresh" type="button">
              Rafraîchir
            </button>
          </div>
          <p class="hint" id="admin-status">
            Chargement des référentiels...
          </p>
        </div>
        <div class="admin-grid">
          <div class="table-card">
            <div class="table-header">
              <h3>Foyers</h3>
              <p class="hint">Identifiants utiles aux créations.</p>
            </div>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Nom</th>
                  </tr>
                </thead>
                <tbody id="admin-households-table"></tbody>
              </table>
            </div>
          </div>
          <div class="table-card">
            <div class="table-header">
              <h3>Personnes</h3>
              <p class="hint">Liées à leur foyer de rattachement.</p>
            </div>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Foyer</th>
                    <th>Nom</th>
                  </tr>
                </thead>
                <tbody id="admin-persons-table"></tbody>
              </table>
            </div>
          </div>
          <div class="table-card">
            <div class="table-header">
              <h3>Véhicules</h3>
              <p class="hint">Flotte professionnelle par personne.</p>
            </div>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Personne</th>
                    <th>Véhicule</th>
                    <th>CV</th>
                  </tr>
                </thead>
                <tbody id="admin-vehicles-table"></tbody>
              </table>
            </div>
          </div>
          <div class="table-card">
            <div class="table-header">
              <h3>Barème kilométrique</h3>
              <p class="hint">Taux en fonction de la puissance fiscale.</p>
            </div>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>CV</th>
                    <th>0 → 5 000 km</th>
                    <th>5 001 → 20 000 km</th>
                    <th>> 20 000 km</th>
                  </tr>
                </thead>
                <tbody id="admin-mileage-scale"></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <section class="admin" aria-label="Saisie des opérations">
        <div class="forms-header">
          <div>
            <h2>Opérations par personne</h2>
            <p class="subtitle">
              Saisissez les trajets, repas et frais divers dans un tableau.
            </p>
          </div>
          <div class="controls">
            <label class="field">
              <span>Personne</span>
              <select id="admin-person-select"></select>
            </label>
            <label class="field">
              <span>Année</span>
              <input
                id="admin-year-input"
                type="number"
                min="2000"
                max="2100"
                value="2024"
              />
            </label>
            <button id="admin-operations-refresh" type="button">
              Charger
            </button>
          </div>
          <p class="hint" id="admin-operations-status">
            Sélectionnez une personne.
          </p>
        </div>
        <div class="admin-grid">
          <div class="table-card">
            <div class="table-header">
              <h3>Trajets</h3>
              <p class="hint">Ajoutez un trajet puis utilisez ⋯.</p>
            </div>
            <div class="table-wrapper">
              <table
                class="entry-table"
                data-entry-type="mileage"
                id="mileage-entries-table"
              >
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Véhicule</th>
                    <th>Mois</th>
                    <th>Kilomètres</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody></tbody>
                <tfoot>
                  <tr>
                    <td>+</td>
                    <td>
                      <select
                        name="vehicle_id"
                        aria-label="Véhicule"
                      ></select>
                    </td>
                    <td>
                      <input
                        name="month"
                        type="number"
                        min="1"
                        max="12"
                        placeholder="Mois"
                      />
                    </td>
                    <td>
                      <input
                        name="km"
                        type="number"
                        min="0"
                        step="0.1"
                        placeholder="Km"
                      />
                    </td>
                    <td>
                      <button
                        type="button"
                        data-add-entry="mileage"
                      >
                        Ajouter
                      </button>
                    </td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>
          <div class="table-card">
            <div class="table-header">
              <h3>Repas</h3>
              <p class="hint">Saisissez les repas par mois.</p>
            </div>
            <div class="table-wrapper">
              <table
                class="entry-table"
                data-entry-type="meals"
                id="meal-entries-table"
              >
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Mois</th>
                    <th>Montant</th>
                    <th>Déductible</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody></tbody>
                <tfoot>
                  <tr>
                    <td>+</td>
                    <td>
                      <input
                        name="month"
                        type="number"
                        min="1"
                        max="12"
                        placeholder="Mois"
                      />
                    </td>
                    <td>
                      <input
                        name="meal_cost"
                        type="number"
                        min="0"
                        step="0.01"
                        placeholder="Montant"
                      />
                    </td>
                    <td class="hint">Auto.</td>
                    <td>
                      <button
                        type="button"
                        data-add-entry="meals"
                      >
                        Ajouter
                      </button>
                    </td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>
          <div class="table-card">
            <div class="table-header">
              <h3>Frais divers</h3>
              <p class="hint">Description, montant et justificatif.</p>
            </div>
            <div class="table-wrapper">
              <table
                class="entry-table"
                data-entry-type="other"
                id="other-entries-table"
              >
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Description</th>
                    <th>Montant</th>
                    <th>Justificatif</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody></tbody>
                <tfoot>
                  <tr>
                    <td>+</td>
                    <td>
                      <input
                        name="description"
                        type="text"
                        maxlength="160"
                        placeholder="Description"
                      />
                    </td>
                    <td>
                      <input
                        name="amount"
                        type="number"
                        min="0"
                        step="0.01"
                        placeholder="Montant"
                      />
                    </td>
                    <td>
                      <input
                        name="attachment_path"
                        type="text"
                        placeholder="Justificatif"
                      />
                    </td>
                    <td>
                      <button
                        type="button"
                        data-add-entry="other"
                      >
                        Ajouter
                      </button>
                    </td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>
        </div>
      </section>
    </div>

    <dialog id="mileage-edit-dialog" class="modal">
      <form id="mileage-edit-form" class="modal-form">
        <div class="modal-header">
          <h3>Modifier un trajet</h3>
          <button type="button" class="icon-button" data-dialog-close>
            ✕
          </button>
        </div>
        <div class="modal-body">
          <input name="id" type="hidden" />
          <label class="field">
            <span>Véhicule</span>
            <select name="vehicle_id"></select>
          </label>
          <label class="field">
            <span>Année</span>
            <input name="year" type="number" min="2000" max="2100" />
          </label>
          <label class="field">
            <span>Mois</span>
            <input name="month" type="number" min="1" max="12" />
          </label>
          <label class="field">
            <span>Kilomètres</span>
            <input name="km" type="number" min="0" step="0.1" />
          </label>
        </div>
        <div class="modal-actions">
          <button type="submit">Mettre à jour</button>
          <button type="button" class="ghost" data-dialog-close>
            Annuler
          </button>
        </div>
      </form>
    </dialog>

    <dialog id="meal-edit-dialog" class="modal">
      <form id="meal-edit-form" class="modal-form">
        <div class="modal-header">
          <h3>Modifier un repas</h3>
          <button type="button" class="icon-button" data-dialog-close>
            ✕
          </button>
        </div>
        <div class="modal-body">
          <input name="id" type="hidden" />
          <label class="field">
            <span>Année</span>
            <input name="year" type="number" min="2000" max="2100" />
          </label>
          <label class="field">
            <span>Mois</span>
            <input name="month" type="number" min="1" max="12" />
          </label>
          <label class="field">
            <span>Montant</span>
            <input name="meal_cost" type="number" min="0" step="0.01" />
          </label>
        </div>
        <div class="modal-actions">
          <button type="submit">Mettre à jour</button>
          <button type="button" class="ghost" data-dialog-close>
            Annuler
          </button>
        </div>
      </form>
    </dialog>

    <dialog id="other-edit-dialog" class="modal">
      <form id="other-edit-form" class="modal-form">
        <div class="modal-header">
          <h3>Modifier un frais divers</h3>
          <button type="button" class="icon-button" data-dialog-close>
            ✕
          </button>
        </div>
        <div class="modal-body">
          <input name="id" type="hidden" />
          <label class="field">
            <span>Année</span>
            <input name="year" type="number" min="2000" max="2100" />
          </label>
          <label class="field">
            <span>Description</span>
            <input name="description" type="text" maxlength="160" />
          </label>
          <label class="field">
            <span>Montant</span>
            <input name="amount" type="number" min="0" step="0.01" />
          </label>
          <label class="field">
            <span>Justificatif</span>
            <input name="attachment_path" type="text" />
          </label>
        </div>
        <div class="modal-actions">
          <button type="submit">Mettre à jour</button>
          <button type="button" class="ghost" data-dialog-close>
            Annuler
          </button>
        </div>
      </form>
    </dialog>

    <dialog id="mileage-delete-dialog" class="modal">
      <form id="mileage-delete-form" class="modal-form">
        <div class="modal-header">
          <h3>Supprimer un trajet</h3>
          <button type="button" class="icon-button" data-dialog-close>
            ✕
          </button>
        </div>
        <div class="modal-body">
          <input name="id" type="hidden" />
          <p>Confirmez la suppression du trajet.</p>
        </div>
        <div class="modal-actions">
          <button type="submit" class="danger">Supprimer</button>
          <button type="button" class="ghost" data-dialog-close>
            Annuler
          </button>
        </div>
      </form>
    </dialog>

    <dialog id="meal-delete-dialog" class="modal">
      <form id="meal-delete-form" class="modal-form">
        <div class="modal-header">
          <h3>Supprimer un repas</h3>
          <button type="button" class="icon-button" data-dialog-close>
            ✕
          </button>
        </div>
        <div class="modal-body">
          <input name="id" type="hidden" />
          <p>Confirmez la suppression du repas.</p>
        </div>
        <div class="modal-actions">
          <button type="submit" class="danger">Supprimer</button>
          <button type="button" class="ghost" data-dialog-close>
            Annuler
          </button>
        </div>
      </form>
    </dialog>

    <dialog id="other-delete-dialog" class="modal">
      <form id="other-delete-form" class="modal-form">
        <div class="modal-header">
          <h3>Supprimer un frais divers</h3>
          <button type="button" class="icon-button" data-dialog-close>
            ✕
          </button>
        </div>
        <div class="modal-body">
          <input name="id" type="hidden" />
          <p>Confirmez la suppression du frais divers.</p>
        </div>
        <div class="modal-actions">
          <button type="submit" class="danger">Supprimer</button>
          <button type="button" class="ghost" data-dialog-close>
            Annuler
          </button>
        </div>
      </form>
    </dialog>

    <script src="/static/admin.js"></script>
  </body>
</html>
